<!DOCTYPE html>
<html>
  <head>
    <title>MtlOnlineMall</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <%= turbo_include_tags %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Stylesheets -->
    <%= stylesheet_link_tag "https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" %>

    <!-- JavaScript -->
    <%= javascript_include_tag "https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <% unless devise_controller? && controller_name.in?(["sessions", "registrations", "passwords"]) %>
      <!-- ✅ Stimulus cart controller wrapper -->
      <div data-controller="cart">
        <%= render "shared/navbar" %>

        <!-- ✅ Cart sidebar with ID for Turbo replacement -->
        <div id="cart-sidebar">
          <%= render "carts/cart_sidebar", locals: { products: Product.where(id: session[:cart] || []) } %>
        </div>
      </div>
    <% end %>

    <!-- ✅ Flash messages -->
    <%= render "shared/flashes" %>

    <main>
      <%= yield %>
    </main>

    <% unless devise_controller? && controller_name.in?(["sessions", "registrations", "passwords"]) || content_for?(:no_footer) %>
      <footer class="bg-dark text-white py-4">
        <div class="container text-center">
          <h5 class="mb-4">Connect With Us</h5>
          <ul class="list-unstyled mb-4">
            <li><a href="mailto:hverar@gmail.com" class="btn btn-outline-light btn-sm mb-2">Email: hverar@gmail.com</a></li>
            <li><a href="https://instagram.com/kik3vr" target="_blank" class="btn btn-outline-light btn-sm mb-2">Instagram: @kik3vr</a></li>
            <li><a href="https://www.facebook.com/henrique.veraramirez" target="_blank" class="btn btn-outline-light btn-sm mb-2">Facebook: MTL Mall</a></li>
          </ul>
          <p class="text-muted small mb-0">&copy; <%= Time.current.year %> MTL Online Mall. All rights reserved.</p>
        </div>
      </footer>
    <% end %>
  </body>
</html>
